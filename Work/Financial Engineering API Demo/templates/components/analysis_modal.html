<!-- Professional Analysis Modal Component -->
<div id="analysisModal" class="analysis-modal" style="display: none;">
  <div class="modal-backdrop" onclick="closeAnalysisModal()"></div>
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">
        <h2 id="modalSymbol">AAPL</h2>
        <div class="price-info">
          <span class="current-price" id="modalPrice">$150.00</span>
          <span class="price-change" id="modalChange">+2.5%</span>
        </div>
      </div>
      <button class="close-btn" onclick="closeAnalysisModal()">&times;</button>
    </div>
    
    <div class="modal-tabs">
      <button class="tab-btn active" onclick="switchTab('overview')">Overview</button>
      <button class="tab-btn" onclick="switchTab('technical')">Technical Analysis</button>
      <button class="tab-btn" onclick="switchTab('historical')">Historical</button>
      <button class="tab-btn" onclick="switchTab('risk')">Risk Analysis</button>
    </div>
    
    <div class="modal-body">
      <!-- Overview Tab -->
      <div id="overviewTab" class="tab-content active">
        <div class="recommendation-box">
          <h3>Recommendation</h3>
          <div class="recommendation-content">
            <div class="rec-rating" id="recRating">BUY</div>
            <div class="rec-confidence">
              <span>Confidence:</span>
              <div class="confidence-bar">
                <div class="confidence-fill" id="confidenceFill" style="width: 75%"></div>
              </div>
              <span id="confidenceValue">75%</span>
            </div>
          </div>
        </div>
        
        <div class="metrics-grid">
          <div class="metric-card">
            <h4>Entry Range</h4>
            <p id="entryRange">$148-152</p>
          </div>
          <div class="metric-card">
            <h4>Stop Loss</h4>
            <p id="stopLoss" class="negative">$142</p>
          </div>
          <div class="metric-card">
            <h4>Target 1</h4>
            <p id="target1" class="positive">$160</p>
          </div>
          <div class="metric-card">
            <h4>Target 2</h4>
            <p id="target2" class="positive">$165</p>
          </div>
        </div>
        
        <div class="analysis-section">
          <h3>Professional Analysis</h3>
          <p id="analysisText" class="analysis-text">
            Loading comprehensive analysis...
          </p>
        </div>
      </div>
      
      <!-- Technical Tab -->
      <div id="technicalTab" class="tab-content">
        <div class="chart-container">
          <canvas id="priceChart" width="800" height="400"></canvas>
        </div>
        
        <div class="indicators-grid">
          <div class="indicator-item">
            <h4>RSI (14)</h4>
            <p id="rsiValue">65</p>
            <span id="rsiSignal" class="signal">Neutral</span>
          </div>
          <div class="indicator-item">
            <h4>MACD</h4>
            <p id="macdValue">Bullish</p>
            <span id="macdSignal" class="signal positive">Buy Signal</span>
          </div>
          <div class="indicator-item">
            <h4>FDV Score</h4>
            <p id="fdvScore">78</p>
            <span class="signal positive">Strong Momentum</span>
          </div>
          <div class="indicator-item">
            <h4>Smart Money</h4>
            <p id="smartMoney">82</p>
            <span class="signal positive">Accumulation</span>
          </div>
        </div>
        
        <div class="volume-profile">
          <h3>Volume Profile</h3>
          <canvas id="volumeProfile" width="800" height="200"></canvas>
          <div class="vp-metrics">
            <span>POC: <strong id="pocLevel">$149.50</strong></span>
            <span>VAH: <strong id="vahLevel">$152.00</strong></span>
            <span>VAL: <strong id="valLevel">$147.00</strong></span>
          </div>
        </div>
      </div>
      
      <!-- Historical Tab -->
      <div id="historicalTab" class="tab-content">
        <div class="timeframe-selector">
          <button class="tf-btn active" onclick="updateTimeframe('1M')">1M</button>
          <button class="tf-btn" onclick="updateTimeframe('3M')">3M</button>
          <button class="tf-btn" onclick="updateTimeframe('6M')">6M</button>
          <button class="tf-btn" onclick="updateTimeframe('1Y')">1Y</button>
          <button class="tf-btn" onclick="updateTimeframe('5Y')">5Y</button>
        </div>
        
        <div class="historical-chart">
          <canvas id="historicalChart" width="800" height="400"></canvas>
        </div>
        
        <div class="performance-table">
          <h3>Historical Performance</h3>
          <table>
            <thead>
              <tr>
                <th>Period</th>
                <th>Return</th>
                <th>vs Sector</th>
                <th>vs Market</th>
              </tr>
            </thead>
            <tbody id="performanceData">
              <tr>
                <td>1 Month</td>
                <td class="positive">+5.2%</td>
                <td class="positive">+2.1%</td>
                <td class="positive">+1.8%</td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <div class="signal-history">
          <h3>Previous Signals</h3>
          <div class="signal-list" id="signalHistory">
            <!-- Populated dynamically -->
          </div>
        </div>
      </div>
      
      <!-- Risk Tab -->
      <div id="riskTab" class="tab-content">
        <div class="risk-overview">
          <div class="risk-score-container">
            <h3>Risk Score</h3>
            <div class="risk-gauge">
              <div class="risk-meter" id="riskMeter"></div>
              <span class="risk-value" id="riskValue">3.2</span>
            </div>
            <p class="risk-rating" id="riskRating">Medium Risk</p>
          </div>
        </div>
        
        <div class="risk-metrics">
          <div class="metric-row">
            <span class="metric-label">Annual Volatility</span>
            <span class="metric-value" id="annualVol">24.5%</span>
          </div>
          <div class="metric-row">
            <span class="metric-label">Sharpe Ratio</span>
            <span class="metric-value" id="sharpeRatio">1.82</span>
          </div>
          <div class="metric-row">
            <span class="metric-label">Max Drawdown</span>
            <span class="metric-value negative" id="maxDrawdown">-18.3%</span>
          </div>
          <div class="metric-row">
            <span class="metric-label">Value at Risk (95%)</span>
            <span class="metric-value negative" id="var95">-2.8%</span>
          </div>
        </div>
        
        <div class="position-sizing">
          <h3>Position Sizing Recommendation</h3>
          <div class="sizing-box">
            <p id="positionSize">Half position (50%)</p>
            <p class="sizing-reason" id="sizingReason">
              Based on current risk score and portfolio correlation
            </p>
          </div>
        </div>
      </div>
    </div>
    
    <div class="modal-footer">
      <button class="action-btn primary" onclick="executeAnalysis()">
        <span class="btn-icon">üìä</span> Full Report
      </button>
      <button class="action-btn secondary" onclick="addToWatchlist()">
        <span class="btn-icon">‚≠ê</span> Add to Watchlist
      </button>
      <button class="action-btn secondary" onclick="shareAnalysis()">
        <span class="btn-icon">üì§</span> Share
      </button>
    </div>
  </div>
</div>

<style>
/* Modal Styles */
.analysis-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 10000;
}

.modal-backdrop {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
}

.modal-content {
  position: relative;
  width: 90%;
  max-width: 1200px;
  height: 90vh;
  margin: 5vh auto;
  background: #111829;
  border: 1px solid #243047;
  border-radius: 12px;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px;
  border-bottom: 1px solid #243047;
  background: #0b1221;
}

.modal-title h2 {
  margin: 0;
  color: #5de0e6;
  font-size: 28px;
}

.price-info {
  margin-top: 8px;
}

.current-price {
  font-size: 24px;
  color: #e8edf6;
  font-weight: bold;
  margin-right: 12px;
}

.price-change {
  font-size: 18px;
}

.price-change.positive { color: #6be07b; }
.price-change.negative { color: #ff7b7b; }

.close-btn {
  background: none;
  border: none;
  color: #e8edf6;
  font-size: 28px;
  cursor: pointer;
  padding: 0 8px;
}

.close-btn:hover { color: #ff7b7b; }

/* Tabs */
.modal-tabs {
  display: flex;
  padding: 0 20px;
  background: #0b1221;
  border-bottom: 1px solid #243047;
}

.tab-btn {
  padding: 12px 24px;
  background: none;
  border: none;
  color: #a0a8b8;
  font-size: 14px;
  cursor: pointer;
  border-bottom: 2px solid transparent;
  transition: all 0.2s;
}

.tab-btn:hover {
  color: #e8edf6;
}

.tab-btn.active {
  color: #5de0e6;
  border-bottom-color: #5de0e6;
}

/* Tab Content */
.modal-body {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
}

.tab-content {
  display: none;
}

.tab-content.active {
  display: block;
}

/* Overview Tab */
.recommendation-box {
  background: #182035;
  border: 1px solid #243047;
  border-radius: 8px;
  padding: 20px;
  margin-bottom: 20px;
}

.recommendation-box h3 {
  margin: 0 0 16px 0;
  color: #5de0e6;
}

.rec-rating {
  font-size: 32px;
  font-weight: bold;
  color: #6be07b;
  margin-bottom: 12px;
}

.rec-confidence {
  display: flex;
  align-items: center;
  gap: 12px;
}

.confidence-bar {
  flex: 1;
  height: 8px;
  background: #243047;
  border-radius: 4px;
  overflow: hidden;
}

.confidence-fill {
  height: 100%;
  background: #5de0e6;
  transition: width 0.3s;
}

.metrics-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 16px;
  margin-bottom: 20px;
}

.metric-card {
  background: #182035;
  border: 1px solid #243047;
  border-radius: 8px;
  padding: 16px;
  text-align: center;
}

.metric-card h4 {
  margin: 0 0 8px 0;
  color: #a0a8b8;
  font-size: 14px;
  font-weight: normal;
}

.metric-card p {
  margin: 0;
  font-size: 20px;
  font-weight: bold;
  color: #e8edf6;
}

.metric-card p.positive { color: #6be07b; }
.metric-card p.negative { color: #ff7b7b; }

.analysis-section {
  background: #182035;
  border: 1px solid #243047;
  border-radius: 8px;
  padding: 20px;
}

.analysis-section h3 {
  margin: 0 0 16px 0;
  color: #5de0e6;
}

.analysis-text {
  color: #e8edf6;
  line-height: 1.8;
  font-size: 15px;
}

/* Technical Tab */
.chart-container {
  background: #182035;
  border: 1px solid #243047;
  border-radius: 8px;
  padding: 20px;
  margin-bottom: 20px;
}

.indicators-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 16px;
  margin-bottom: 20px;
}

.indicator-item {
  background: #182035;
  border: 1px solid #243047;
  border-radius: 8px;
  padding: 16px;
  text-align: center;
}

.indicator-item h4 {
  margin: 0 0 8px 0;
  color: #5de0e6;
  font-size: 14px;
}

.indicator-item p {
  margin: 0 0 4px 0;
  font-size: 24px;
  font-weight: bold;
  color: #e8edf6;
}

.signal {
  font-size: 12px;
  color: #a0a8b8;
}

.signal.positive { color: #6be07b; }
.signal.negative { color: #ff7b7b; }

.volume-profile {
  background: #182035;
  border: 1px solid #243047;
  border-radius: 8px;
  padding: 20px;
}

.volume-profile h3 {
  margin: 0 0 16px 0;
  color: #5de0e6;
}

.vp-metrics {
  display: flex;
  gap: 24px;
  margin-top: 16px;
  font-size: 14px;
  color: #a0a8b8;
}

.vp-metrics strong {
  color: #e8edf6;
}

/* Historical Tab */
.timeframe-selector {
  display: flex;
  gap: 8px;
  margin-bottom: 20px;
}

.tf-btn {
  padding: 8px 16px;
  background: #182035;
  border: 1px solid #243047;
  color: #a0a8b8;
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.2s;
}

.tf-btn:hover {
  border-color: #5de0e6;
}

.tf-btn.active {
  background: #5de0e6;
  color: #0b1221;
  border-color: #5de0e6;
}

.historical-chart {
  background: #182035;
  border: 1px solid #243047;
  border-radius: 8px;
  padding: 20px;
  margin-bottom: 20px;
}

.performance-table {
  background: #182035;
  border: 1px solid #243047;
  border-radius: 8px;
  padding: 20px;
  margin-bottom: 20px;
}

.performance-table h3 {
  margin: 0 0 16px 0;
  color: #5de0e6;
}

.performance-table table {
  width: 100%;
  border-collapse: collapse;
}

.performance-table th {
  text-align: left;
  padding: 8px;
  border-bottom: 1px solid #243047;
  color: #a0a8b8;
  font-weight: normal;
}

.performance-table td {
  padding: 8px;
  color: #e8edf6;
}

.performance-table td.positive { color: #6be07b; }
.performance-table td.negative { color: #ff7b7b; }

/* Risk Tab */
.risk-overview {
  text-align: center;
  margin-bottom: 30px;
}

.risk-gauge {
  width: 200px;
  height: 100px;
  margin: 20px auto;
  position: relative;
  background: #182035;
  border: 2px solid #243047;
  border-radius: 100px 100px 0 0;
  overflow: hidden;
}

.risk-meter {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 50%;
  background: linear-gradient(to right, #6be07b, #ffd700, #ff7b7b);
  transform-origin: bottom center;
  transition: transform 0.5s;
}

.risk-value {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 32px;
  font-weight: bold;
  color: #e8edf6;
}

.risk-rating {
  font-size: 18px;
  color: #5de0e6;
  margin-top: 10px;
}

.risk-metrics {
  background: #182035;
  border: 1px solid #243047;
  border-radius: 8px;
  padding: 20px;
  margin-bottom: 20px;
}

.metric-row {
  display: flex;
  justify-content: space-between;
  padding: 12px 0;
  border-bottom: 1px solid #243047;
}

.metric-row:last-child {
  border-bottom: none;
}

.metric-label {
  color: #a0a8b8;
}

.metric-value {
  font-weight: bold;
  color: #e8edf6;
}

.metric-value.negative { color: #ff7b7b; }

.position-sizing {
  background: #182035;
  border: 1px solid #243047;
  border-radius: 8px;
  padding: 20px;
}

.position-sizing h3 {
  margin: 0 0 16px 0;
  color: #5de0e6;
}

.sizing-box {
  background: #0b1221;
  padding: 16px;
  border-radius: 6px;
}

.sizing-box p {
  margin: 0 0 8px 0;
  font-size: 20px;
  font-weight: bold;
  color: #e8edf6;
}

.sizing-reason {
  font-size: 14px;
  color: #a0a8b8;
  font-weight: normal;
}

/* Footer */
.modal-footer {
  display: flex;
  gap: 12px;
  padding: 20px;
  border-top: 1px solid #243047;
  background: #0b1221;
}

.action-btn {
  padding: 10px 20px;
  border: none;
  border-radius: 6px;
  font-size: 14px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 8px;
  transition: all 0.2s;
}

.action-btn.primary {
  background: #5de0e6;
  color: #0b1221;
  font-weight: bold;
}

.action-btn.primary:hover {
  background: #4bc4ca;
}

.action-btn.secondary {
  background: #182035;
  color: #e8edf6;
  border: 1px solid #243047;
}

.action-btn.secondary:hover {
  background: #243047;
  border-color: #5de0e6;
}

.btn-icon {
  font-size: 16px;
}

/* Scrollbar */
.modal-body::-webkit-scrollbar {
  width: 8px;
}

.modal-body::-webkit-scrollbar-track {
  background: #0b1221;
}

.modal-body::-webkit-scrollbar-thumb {
  background: #243047;
  border-radius: 4px;
}

.modal-body::-webkit-scrollbar-thumb:hover {
  background: #5de0e6;
}
</style>
